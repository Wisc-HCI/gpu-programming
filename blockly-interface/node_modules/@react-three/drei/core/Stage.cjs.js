"use strict";var e=require("@babel/runtime/helpers/extends"),t=require("react"),n=require("./Environment.cjs.js"),i=require("./ContactShadows.cjs.js"),a=require("./Center.cjs.js"),r=require("./AccumulativeShadows.cjs.js"),l=require("./Bounds.cjs.js");function o(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var s=o(t);const u={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function c({radius:e,adjustCamera:t}){const n=l.useBounds();return s.useEffect((()=>{t&&n.refresh().clip().fit()}),[e,t]),null}exports.Stage=function({children:t,center:o,adjustCamera:d=!0,intensity:m=.5,shadows:p="contact",environment:h="city",preset:f="rembrandt",...v}){var b,j,g,E,y,w,C,S;const q="string"==typeof f?u[f]:f,[{radius:z,height:O},B]=s.useState({radius:0,width:0,height:0,depth:0}),L=null!==(b=null==p?void 0:p.bias)&&void 0!==b?b:-1e-4,k=null!==(j=null==p?void 0:p.normalBias)&&void 0!==j?j:0,x=null!==(g=null==p?void 0:p.size)&&void 0!==g?g:1024,A=null!==(E=null==p?void 0:p.offset)&&void 0!==E?E:0,P="contact"===p||"contact"===(null==p?void 0:p.type),D="accumulative"===p||"accumulative"===(null==p?void 0:p.type),F={..."object"==typeof p?p:{}},M=h?"string"==typeof h?{preset:h}:h:null,N=s.useCallback((e=>{const{width:t,height:n,depth:i,boundingSphere:a}=e;B({radius:a.radius,width:t,height:n,depth:i}),null!=o&&o.onCentered&&o.onCentered(e)}),[]);return s.createElement(s.Fragment,null,s.createElement("ambientLight",{intensity:m/3}),s.createElement("spotLight",{penumbra:1,position:[q.main[0]*z,q.main[1]*z,q.main[2]*z],intensity:2*m,castShadow:!!p,"shadow-bias":L,"shadow-normalBias":k,"shadow-mapSize":x}),s.createElement("pointLight",{position:[q.fill[0]*z,q.fill[1]*z,q.fill[2]*z],intensity:m}),s.createElement(l.Bounds,e({fit:!!d,clip:!!d,margin:Number(d),observe:!0},v),s.createElement(c,{radius:z,adjustCamera:d}),s.createElement(a.Center,e({},o,{position:[0,A/2,0],onCentered:N}),t)),s.createElement("group",{position:[0,-O/2-A/2,0]},P&&s.createElement(i.ContactShadows,e({scale:4*z,far:z,blur:2},F)),D&&s.createElement(r.AccumulativeShadows,e({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:4*z},F),s.createElement(r.RandomizedLight,{amount:null!==(y=F.amount)&&void 0!==y?y:8,radius:null!==(w=F.radius)&&void 0!==w?w:z,ambient:null!==(C=F.ambient)&&void 0!==C?C:.5,intensity:null!==(S=F.intensity)&&void 0!==S?S:1,position:[q.main[0]*z,q.main[1]*z,q.main[2]*z],size:4*z,bias:-L,mapSize:x}))),h&&s.createElement(n.Environment,M))};
