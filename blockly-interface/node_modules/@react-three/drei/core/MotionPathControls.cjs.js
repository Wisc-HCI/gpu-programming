"use strict";var e=require("@babel/runtime/helpers/extends"),t=require("three"),r=require("react"),n=require("@react-three/fiber"),o=require("maath");function u(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var c=u(t),s=u(r);const a=s.createContext(null);function i(){return s.useContext(a)}function f({points:e=50}){const{path:t}=i(),[r,n]=s.useState([]),[o]=s.useState((()=>new c.MeshBasicMaterial({color:"black"}))),[u]=s.useState((()=>new c.SphereGeometry(.025,16,16))),a=s.useRef([]);return s.useEffect((()=>{t.curves!==a.current&&(n(t.getPoints(e)),a.current=t.curves)})),s.createElement(s.Fragment,null,r.map(((e,t)=>s.createElement("mesh",{key:t,material:o,geometry:u,position:[e.x,e.y,e.z]}))))}const l=s.forwardRef((({children:t,curves:r=[],object:u,debug:i=!1,smooth:l=!1,focus:m,offset:p,eps:g=1e-5,damping:d=.1,focusDamping:v=.1,maxSpeed:h=1/0,...b},j)=>{const{camera:y}=n.useThree(),w=s.useRef(),[P]=s.useState((()=>new c.CurvePath)),x=s.useRef(null!=p?p:0),E=s.useMemo((()=>({focus:m,object:(null==u?void 0:u.current)instanceof c.Object3D?u:{current:y},path:P,current:x.current,offset:x.current,point:new c.Vector3,tangent:new c.Vector3,next:new c.Vector3})),[m,u]);s.useLayoutEffect((()=>{var e;P.curves=[];const t=r.length>0?r:null==(e=w.current)?void 0:e.__r3f.objects;for(var n=0;n<t.length;n++)P.add(t[n]);if(l){const e=P.getPoints("number"==typeof l?l:1),t=new c.CatmullRomCurve3(e);P.curves=[t]}P.updateArcLengths()})),s.useImperativeHandle(j,(()=>w.current),[]),s.useLayoutEffect((()=>{x.current=o.misc.repeat(x.current,1)}),[p]);let O=0;const[C]=s.useState((()=>new c.Vector3));return n.useFrame(((e,t)=>{if(O=E.offset,o.easing.damp(x,"current",void 0!==p?p:E.current,d,t,h,void 0,g),E.offset=o.misc.repeat(x.current,1),P.getCurveLengths().length>0){P.getPointAt(E.offset,E.point),P.getTangentAt(E.offset,E.tangent).normalize(),P.getPointAt(o.misc.repeat(x.current-(O-E.offset),1),E.next);const e=(null==u?void 0:u.current)instanceof c.Object3D?u.current:y;e.position.copy(E.point),m&&o.easing.dampLookAt(e,(e=>(null==e?void 0:e.current)instanceof c.Object3D)(m)?m.current.getWorldPosition(C):m,v,t,h,void 0,g)}})),s.createElement("group",e({ref:w},b),s.createElement(a.Provider,{value:E},t,i&&s.createElement(f,null)))}));exports.MotionPathControls=l,exports.useMotion=i;
