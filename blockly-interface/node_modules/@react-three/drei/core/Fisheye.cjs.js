"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("three"),t=require("react"),a=require("@react-three/fiber"),n=require("./RenderCubeTexture.cjs.js");function i(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var a=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,a.get?a:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var c=i(r),o=i(t);function s({api:e}){const r=new c.Vector3,t=new c.Quaternion,n=new c.Vector3,i=new c.Euler(0,Math.PI,0);return a.useFrame((a=>{a.camera.matrixWorld.decompose(r,t,n),e.current.camera.position.copy(r),e.current.camera.quaternion.setFromEuler(i).premultiply(t)})),null}exports.Fisheye=function({renderPriority:r=1,zoom:t=0,segments:i=64,children:u,resolution:l=896,...m}){const p=o.useRef(null),f=o.useRef(null),{width:h,height:y}=a.useThree((e=>e.size)),[d]=o.useState((()=>new c.OrthographicCamera));o.useLayoutEffect((()=>{d.position.set(0,0,100),d.zoom=100,d.left=h/-2,d.right=h/2,d.top=y/2,d.bottom=y/-2,d.updateProjectionMatrix()}),[h,y]);const g=Math.sqrt(h*h+y*y)/100*(.5+t/2),b=new c.Vector3,w=new c.Sphere(new c.Vector3,g),x=new c.Matrix3,E=o.useCallback(((e,r,t)=>{r.pointer.set(e.offsetX/r.size.width*2-1,-e.offsetY/r.size.height*2+1),r.raycaster.setFromCamera(r.pointer,d),r.raycaster.ray.intersectSphere(w,b)&&(b.normalize(),x.getNormalMatrix(f.current.camera.matrixWorld),f.current.camera.getWorldPosition(r.raycaster.ray.origin),r.raycaster.ray.direction.set(0,0,1).reflect(b),r.raycaster.ray.direction.x*=-1,r.raycaster.ray.direction.applyNormalMatrix(x).multiplyScalar(-1))}),[]);return a.useFrame((e=>{r&&e.gl.render(p.current,d)}),r),o.createElement(o.Fragment,null,o.createElement("mesh",e({ref:p},m,{scale:g}),o.createElement("sphereGeometry",{args:[1,i,i]}),o.createElement("meshBasicMaterial",null,o.createElement(n.RenderCubeTexture,{compute:E,attach:"envMap",flip:!0,resolution:l,ref:f},u,o.createElement(s,{api:f})))))};
