"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("react"),n=require("@react-three/fiber"),t=require("three"),u=require("three-stdlib"),o=require("./useEnvironment.cjs.js");function c(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var t=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,t.get?t:{enumerable:!0,get:function(){return e[n]}})}})),r.default=e,Object.freeze(r)}var a=c(r);const s=e=>{return(r=e).current&&r.current.isScene?e.current:e;var r};function l(e,r,n,t,u=0){const o=s(r||n),c=o.background,a=o.environment,l=o.backgroundBlurriness||0;return"only"!==e&&(o.environment=t),e&&(o.background=t),e&&void 0!==o.backgroundBlurriness&&(o.backgroundBlurriness=u),()=>{"only"!==e&&(o.environment=a),e&&(o.background=c),e&&void 0!==o.backgroundBlurriness&&(o.backgroundBlurriness=l)}}function i({scene:e,background:r=!1,blur:t,map:u}){const o=n.useThree((e=>e.scene));return a.useLayoutEffect((()=>{if(u)return l(r,e,o,u,t)}),[o,e,u,r,t]),null}function d({background:e=!1,scene:r,blur:t,...u}){const c=o.useEnvironment(u),s=n.useThree((e=>e.scene));return a.useLayoutEffect((()=>l(e,r,s,c,t)),[c,e,r,s,t]),null}function m({children:e,near:r=1,far:u=1e3,resolution:o=256,frames:c=1,map:s,background:m=!1,blur:b,scene:f,files:g,path:E,preset:p,extensions:v}){const h=n.useThree((e=>e.gl)),k=n.useThree((e=>e.scene)),x=a.useRef(null),[j]=a.useState((()=>new t.Scene)),y=a.useMemo((()=>{const e=new t.WebGLCubeRenderTarget(o);return e.texture.type=t.HalfFloatType,e}),[o]);a.useLayoutEffect((()=>(1===c&&x.current.update(h,j),l(m,f,k,y.texture,b))),[e,j,y.texture,f,k,m,c,h]);let P=1;return n.useFrame((()=>{(c===1/0||P<c)&&(x.current.update(h,j),P++)})),a.createElement(a.Fragment,null,n.createPortal(a.createElement(a.Fragment,null,e,a.createElement("cubeCamera",{ref:x,args:[r,u,y]}),g||p?a.createElement(d,{background:!0,files:g,preset:p,path:E,extensions:v}):s?a.createElement(i,{background:!0,map:s,extensions:v}):null),j))}function b(r){var t,c,s,l;const d=o.useEnvironment(r),m=r.map||d;a.useMemo((()=>n.extend({GroundProjectedEnvImpl:u.GroundProjectedEnv})),[]);const b=a.useMemo((()=>[m]),[m]),f=null==(t=r.ground)?void 0:t.height,g=null==(c=r.ground)?void 0:c.radius,E=null!==(s=null==(l=r.ground)?void 0:l.scale)&&void 0!==s?s:1e3;return a.createElement(a.Fragment,null,a.createElement(i,e({},r,{map:m})),a.createElement("groundProjectedEnvImpl",{args:b,scale:E,height:f,radius:g}))}exports.Environment=function(e){return e.ground?a.createElement(b,e):e.map?a.createElement(i,e):e.children?a.createElement(m,e):a.createElement(d,e)},exports.EnvironmentCube=d,exports.EnvironmentMap=i,exports.EnvironmentPortal=m;
