"use strict";var e=require("react"),r=require("@react-three/fiber"),t=require("three"),n=require("./OrthographicCamera.cjs.js"),o=require("./Hud.cjs.js");function u(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var a=u(e);const i=a.createContext({}),c=2*Math.PI,s=new t.Object3D,l=new t.Matrix4,[p,f]=[new t.Quaternion,new t.Quaternion],d=new t.Vector3,h=new t.Vector3;exports.GizmoHelper=({alignment:e="bottom-right",margin:u=[80,80],renderPriority:m=1,onUpdate:y,onTarget:g,children:w})=>{const v=r.useThree((e=>e.size)),b=r.useThree((e=>e.camera)),j=r.useThree((e=>e.controls)),q=r.useThree((e=>e.invalidate)),O=a.useRef(null),x=a.useRef(null),T=a.useRef(!1),C=a.useRef(0),P=a.useRef(new t.Vector3(0,0,0)),R=a.useRef(new t.Vector3(0,0,0));a.useEffect((()=>{R.current.copy(b.up)}),[b]);const E=a.useCallback((e=>{T.current=!0,(j||g)&&(P.current=(null==j?void 0:j.target)||(null==g?void 0:g())),C.current=b.position.distanceTo(d),p.copy(b.quaternion),h.copy(e).multiplyScalar(C.current).add(d),s.lookAt(h),s.up.copy(b.up),f.copy(s.quaternion),q()}),[j,b,g,q]);r.useFrame(((e,r)=>{if(x.current&&O.current){var t;if(T.current)if(p.angleTo(f)<.01)T.current=!1,"minPolarAngle"in j&&b.up.copy(R.current);else{const e=r*c;p.rotateTowards(f,e),b.position.set(0,0,1).applyQuaternion(p).multiplyScalar(C.current).add(P.current),b.up.set(0,1,0).applyQuaternion(p).normalize(),b.quaternion.copy(p),y?y():j&&j.update(),q()}l.copy(b.matrix).invert(),null==(t=O.current)||t.quaternion.setFromRotationMatrix(l)}}));const z=a.useMemo((()=>({tweenCamera:E})),[E]),[k,M]=u,Q=e.endsWith("-center")?0:e.endsWith("-left")?-v.width/2+k:v.width/2-k,V=e.startsWith("center-")?0:e.startsWith("top-")?v.height/2-M:-v.height/2+M;return a.createElement(o.Hud,{renderPriority:m},a.createElement(i.Provider,{value:z},a.createElement(n.OrthographicCamera,{makeDefault:!0,ref:x,position:[0,0,200]}),a.createElement("group",{ref:O,position:[Q,V,0]},w)))},exports.useGizmoContext=()=>a.useContext(i);
