"use strict";var e=require("@babel/runtime/helpers/extends"),r=require("three"),t=require("react"),n=require("@react-three/fiber"),a=require("./useFBO.cjs.js");function u(e){var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var i=u(r),l=u(t);const c=l.forwardRef((({children:r,compute:t,width:u,height:c,samples:o=8,renderPriority:f=0,eventPriority:m=0,frames:p=1/0,stencilBuffer:d=!1,depthBuffer:g=!0,generateMipmaps:b=!1,...v},h)=>{const{size:y,viewport:O}=n.useThree(),j=a.useFBO((u||y.width)*O.dpr,(c||y.height)*O.dpr,{samples:o,stencilBuffer:d,depthBuffer:g,generateMipmaps:b}),[x]=l.useState((()=>new i.Scene)),P=l.useCallback(((e,r,t)=>{var n,a;let u=null==(n=j.texture)?void 0:n.__r3f.parent;for(;u&&!(u instanceof i.Object3D);)u=u.__r3f.parent;if(!u)return!1;t.raycaster.camera||t.events.compute(e,t,null==(a=t.previousRoot)?void 0:a.getState());const[l]=t.raycaster.intersectObject(u);if(!l)return!1;const c=l.uv;if(!c)return!1;r.raycaster.setFromCamera(r.pointer.set(2*c.x-1,2*c.y-1),r.camera)}),[]);return l.useImperativeHandle(h,(()=>j.texture),[j]),l.createElement(l.Fragment,null,n.createPortal(l.createElement(s,{renderPriority:f,frames:p,fbo:j},r,l.createElement("group",{onPointerOver:()=>null})),x,{events:{compute:t||P,priority:m}}),l.createElement("primitive",e({object:j.texture},v)))}));function s({frames:e,renderPriority:r,children:t,fbo:a}){let u,i,c=0;return n.useFrame((r=>{(e===1/0||c<e)&&(u=r.gl.autoClear,i=r.gl.xr.enabled,r.gl.autoClear=!0,r.gl.xr.enabled=!1,r.gl.setRenderTarget(a),r.gl.render(r.scene,r.camera),r.gl.setRenderTarget(null),r.gl.autoClear=u,r.gl.xr.enabled=i,c++)}),r),l.createElement(l.Fragment,null,t)}exports.RenderTexture=c;
