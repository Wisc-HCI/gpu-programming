"use strict";var e=require("@babel/runtime/helpers/extends"),t=require("react"),n=require("three"),r=require("three-stdlib"),o=require("@react-three/fiber"),i=require("zustand/shallow");function l(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var s=l(t),c=l(n);const u=s.createContext([]);exports.Select=function({box:t,multiple:n,children:l,onChange:a,onChangePointerUp:d,border:f="1px solid #55aaff",backgroundColor:p="rgba(75, 160, 255, 0.1)",filter:h=(e=>e),...v}){const[b,m]=s.useState(!1),{setEvents:y,camera:x,raycaster:E,gl:g,controls:w,size:C,get:P}=o.useThree(),[j,O]=s.useState(!1),[k,q]=s.useReducer(((e,{object:t,shift:n})=>void 0===t?[]:Array.isArray(t)?t:n?e.includes(t)?e.filter((e=>e!==t)):[t,...e]:e[0]===t?[]:[t]),[]);s.useEffect((()=>{b?null==a||a(k):null==d||d(k)}),[k,b]);const L=s.useCallback((e=>{e.stopPropagation(),q({object:h([e.object])[0],shift:n&&e.shiftKey})}),[]),M=s.useCallback((e=>!j&&q({})),[j]),S=s.useRef(null);return s.useEffect((()=>{if(!t||!n)return;const e=new r.SelectionBox(x,S.current),o=document.createElement("div");o.style.pointerEvents="none",o.style.border=f,o.style.backgroundColor=p,o.style.position="fixed";const l=new c.Vector2,s=new c.Vector2,u=new c.Vector2,a=P().events.enabled,d=null==w?void 0:w.enabled;let v=!1;function b(e,t){const{offsetX:n,offsetY:r}=e,{width:o,height:i}=C;t.set(n/o*2-1,-r/i*2+1)}function E(t){t.shiftKey&&(!function(e){var t;w&&(w.enabled=!1),y({enabled:!1}),m(v=!0),null==(t=g.domElement.parentElement)||t.appendChild(o),o.style.left=`${e.clientX}px`,o.style.top=`${e.clientY}px`,o.style.width="0px",o.style.height="0px",l.x=e.clientX,l.y=e.clientY}(t),b(t,e.startPoint))}let j=[];function O(t){if(v){!function(e){u.x=Math.max(l.x,e.clientX),u.y=Math.max(l.y,e.clientY),s.x=Math.min(l.x,e.clientX),s.y=Math.min(l.y,e.clientY),o.style.left=`${s.x}px`,o.style.top=`${s.y}px`,o.style.width=u.x-s.x+"px",o.style.height=u.y-s.y+"px"}(t),b(t,e.endPoint);const n=e.select().sort((e=>e.uuid)).filter((e=>e.isMesh));i(n,j)||(j=n,q({object:h(n)}))}}function k(e){var t;v&&v&&(w&&(w.enabled=d),y({enabled:a}),m(v=!1),null==(t=o.parentElement)||t.removeChild(o))}return document.addEventListener("pointerdown",E,{passive:!0}),document.addEventListener("pointermove",O,{passive:!0,capture:!0}),document.addEventListener("pointerup",k,{passive:!0}),()=>{document.removeEventListener("pointerdown",E),document.removeEventListener("pointermove",O),document.removeEventListener("pointerup",k)}}),[C.width,C.height,E,x,w,g]),s.createElement("group",e({ref:S,onClick:L,onPointerOver:()=>O(!0),onPointerOut:()=>O(!1),onPointerMissed:M},v),s.createElement(u.Provider,{value:k},l))},exports.useSelect=function(){return s.useContext(u)};
